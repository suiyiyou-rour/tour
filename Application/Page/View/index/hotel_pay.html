<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>
        <if condition="isset($_COOKIE['company'])">
            {$_COOKIE['company']}
            <else/> 随意游-suiyiyou.net
        </if>
    </title>
    <link rel="stylesheet" href="__PUBLIC__/Weixin/dist/hotel_pay.min.css?st=v1.0.1">
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script>
        window.public = "__PUBLIC__";
        window.controller = "__CONTROLLER__";
    </script>
</head>

<body>
    <input type="hidden" id='js' value="{$jsApiParameters}">

    <p class="main-title">待支付订单</p>
    <img id="orderPic" src="" alt="">
    <div id="orderMessBox">
        <div class="item">
            <p class="title">过期时间 : </p>
            <p class="mess" id="orderCount">--</p>
        </div>
        <div class="item">
            <p class="title">订单号 : </p>
            <p class="mess" id="orderNum">--</p>
        </div>
        <div class="item">
            <p class="title">产品ID : </p>
            <p class="mess" id="proNum">--</p>
        </div>
        <div class="item">
            <p class="title">产品名称 : </p>
            <p class="mess" id="orderName">--</p>
        </div>
        <div class="item">
            <p class="title">入住日期 : </p>
            <p class="mess" id="orderTime">--</p>
        </div>
        <div class="item">
            <p class="title">数量 : </p>
            <p class="mess" id="num">--</p>
        </div>
        <div class="item">
            <p class="title">联系人 : </p>
            <p class="mess" id="connectName">--</p>
        </div>
        <div class="item">
            <p class="title">联系手机号 : </p>
            <p class="mess" id="connectMobile">--</p>
        </div>
        <div id="identifyBox"></div>
        <div class="item">
            <p class="title">备注 : </p>
            <p class="mess" id="remarks">--</p>
        </div>
    </div>
    <div class="bottom-box">
        <p class="price">总价 : ￥
            <span id="totalNum">--</span>
        </p>
        <button id="takeOrderBtn">立即下单</button>
    </div>
</body>
<script src="__PUBLIC__/common/jquery-2.1.1.min.js"></script>
<script src="__PUBLIC__/Weixin/dist/hotel_pay.min.js?st=v1.0.2"></script>
<script>
    //调用微信JS api 支付
    function jsApiCall() {

        var js = $('#js').val();

        WeixinJSBridge.invoke(
            'getBrandWCPayRequest',
            {$jsApiParameters},
            function (res) {
                if (res.err_msg == "get_brand_wcpay_request:ok") {
                    alert("支付成功!");
                    location.href = "http://www.suiyiyou.net{:U('Index/order')}";

                } else if (res.err_msg == "get_brand_wcpay_request:cancel") {
                    alert("支付取消!");

                } else {
                    alert("支付失败!");
                }
            }
        );
    }

    function callpay() {
        if (typeof WeixinJSBridge == "undefined") {
            if (document.addEventListener) {
                document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
            } else if (document.attachEvent) {
                document.attachEvent('WeixinJSBridgeReady', jsApiCall);
                document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
            }
        } else {
            jsApiCall();
        }
    }

    $('#takeOrderBtn').click(function () {
        callpay();
    })
</script>

</html>